---
layout: post
title: PhxPaxosæµ‹è¯•
tags: Paxos
categories: æŠ€æœ¯æ–‡ç« 
---

[ğŸ”—ä»“åº“é“¾æ¥](https://gitee.com/tjopenlab/phxpaxos)

## 1 æµ‹è¯•ç¯å¢ƒ

### 1.1 ç¡¬ä»¶ç¯å¢ƒ

å®éªŒä½¿ç”¨3å°Ubuntu 22.04 x86 PCï¼Œç¡¬ä»¶é…ç½®åˆ†åˆ«å¦‚ä¸‹ï¼š

| è®¾å¤‡   | åç§°       | CPU                                          | å†…å­˜   |
|--------|-----------|----------------------------------------------|--------|
| PC1    | tjopenlab | Intel Core i5-3470 3.2GHz 4æ ¸4çº¿ç¨‹            | 16GB   |
| PC2    | poweredge | Intel Xeon CPU E5-2403 v2 1.8GHz 2åº§4æ ¸4çº¿ç¨‹  | 32GB   |
| PC3    | inspiron  | Intel Core i5-4210U 1.7GHz 2æ ¸2çº¿ç¨‹           | 6GB    |

æ³¨æ„ï¼šç”±äºWindowsä¸æ”¯æŒPOSIXï¼ŒWSL Ubuntuå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå»ºè®®åœ¨çº¯Linuxç¯å¢ƒä¸‹ç¼–è¯‘æµ‹è¯•ã€‚

### 1.2 ç½‘ç»œç¯å¢ƒ

ç¡®ä¿å„è®¾å¤‡å¤„äºåŒä¸€å±€åŸŸç½‘ä¸‹ã€‚å‡è®¾å„è®¾å¤‡IPåˆ†åˆ«ä¸ºï¼š

| ç¼–å· | åç§°        | IPåœ°å€         |
|------|------------|----------------|
| PC1  | tjopenlab  | 192.168.0.12   |
| PC2  | poweredge  | 192.168.0.22   |
| PC3  | inspiron   | 192.168.0.10   |

## 2 ç¼–è¯‘

PhxPaxosä¾èµ–2ä¸ªå…±äº«åº“ï¼šPhxPaxos.soå’Œcomort.soã€‚ä¸‹é¢åœ¨ä¸€å°ä¸»æœºä¸Šç¼–è¯‘å®ƒä»¬ï¼Œå¹¶ä¼ è¾“åˆ°å…¶ä»–ä¸»æœºã€‚é¦–å…ˆè¿›è¡Œç¼–è¯‘ï¼š
```sh
# å…‹éš†COMOä»“åº“(åŒ…æ‹¬å­ä»“åº“)
git clone https://gitee.com/tjopenlab/como.git --recursive
# å®‰è£…COMOæ‰€éœ€ä¾èµ–
sudo apt install build-essential cmake libdbus-1-dev libunwind8-dev libicu-dev dh-autoreconf libtool -y
# å®‰è£…å¤–éƒ¨ç¼–è¯‘ä¾èµ–
sudo apt install python3 python-is-python3
# ç¼–è¯‘COMO
cd como
source build/envsetup.sh
como_linux_x64
build
# ç¼–è¯‘å¤–éƒ¨ç»„ä»¶(åŒ…æ‹¬phxpaxos)
cd ../../.. # comoç›®å½•
./MakeOptionalExternal.sh
```

æŸ¥çœ‹ç¼–è¯‘å¾—åˆ°çš„PhxPaxos.soå’Œå¯æ‰§è¡Œæ–‡ä»¶phxcomo_testï¼š
```sh
ls ~/Work/1-2025/como/external/phxpaxos/export_como | grep -E 'PhxPaxos.so|phxcomo_test'
```
æŸ¥çœ‹ç¼–è¯‘å¾—åˆ°çš„comort.soï¼š
```sh
ls ~/Work/1-2025/como/bin/target/como.linux.x64.rls | grep comort.so
```

åœ¨æœ¬æœºï¼Œå°†ä¸Šè¿°2æ¡è·¯å¾„è®¾ç½®ä¸ºåŠ¨æ€é“¾æ¥åº“çš„æœç´¢è·¯å¾„ï¼ˆä»¥å†’å·åˆ†éš”ï¼‰ï¼š
```sh
export LD_LIBRARY_PATH=/home/user/Work/1-2025/como/external/phxpaxos/export_como:/home/user/Work/1-2025/como/bin/target/como.linux.x64.rls
```

å°†ä¸Šè¿°3ä¸ªæ–‡ä»¶ä¼ è¾“åˆ°å…¶ä»–ä¸»æœºï¼š
```sh
scp ~/Work/1-2025/como/external/phxpaxos/export_como/PhxPaxos.so user@192.168.0.22:~/Work/1-2025/
scp ~/Work/1-2025/como/external/phxpaxos/export_como/phxcomo_test user@192.168.0.22:~/Work/1-2025/
scp ~/Work/1-2025/como/bin/target/como.linux.x64.rls/comort.so user@192.168.0.22:~/Work/1-2025/
```

åœ¨å…¶ä»–ä¸»æœºè®¾ç½®å¯¹åº”åŠ¨æ€é“¾æ¥åº“çš„æœç´¢è·¯å¾„ï¼ˆå‡è®¾äº‹å…ˆå°†ä¸Šè¿°æ–‡ä»¶æ”¾åœ¨phxpaxos_binç›®å½•ä¸‹ï¼‰ï¼š
```sh
export LD_LIBRARY_PATH=/home/user/Work/1-2025/phxpaxos_bin
```

## 3 è¿è¡Œæµ‹è¯•

### 3.1 æ–¹æ³•

ç¨‹åºå‚æ•°æ ¼å¼å¦‚ä¸‹ï¼š
```sh
./phxcomo_test ip1:port1 ip1:port1,ip2:port2,ip3:port3 <y/n>
```
æ³¨æ„ï¼šå…¶ä¸­å‚æ•°`ip1:port1`æ˜¯å½“å‰ä¸»æœºçš„IPåœ°å€å’Œç«¯å£ï¼›å‚æ•°`ip1:port1,ip2:port2,ip3:port3`æ˜¯åŒ…æ‹¬æœ¬æœºåœ¨å†…çš„æ‰€æœ‰ä¸»æœºçš„IPå’Œç«¯å£ï¼Œä»¥é€—å·åˆ†éš”ï¼›`<y\n>`è¡¨ç¤ºæ˜¯å¦ä¸ºå‘é€èŠ‚ç‚¹ï¼Œyè¡¨ç¤ºå‘é€ï¼Œnè¡¨ç¤ºåªæ¥æ”¶è€Œä¸å‘é€ã€‚å…ˆè¿è¡Œæ¥æ”¶èŠ‚ç‚¹ï¼Œåè¿è¡Œå‘é€èŠ‚ç‚¹ã€‚

å…ˆåœ¨å¦å¤–2å°ä¸»æœºä¸Šè¿è¡Œphxpaxos_testï¼ˆä½œä¸ºæ¥æ”¶èŠ‚ç‚¹ï¼‰ï¼Œç¨‹åºå°†é˜»å¡ç­‰å¾…æ¥æ”¶ã€‚ä¹‹ååœ¨æœ¬æœºè¿è¡Œphxpaxos_testï¼ˆä½œä¸ºå‘é€èŠ‚ç‚¹ï¼‰ã€‚ç«¯å£å·å¯ä»¥ä»»æ„é€‰å–ï¼Œä¸å†²çªå³å¯ï¼Œå¦‚1111ã€‚ç¤ºä¾‹æŒ‡ä»¤å¦‚ä¸‹ï¼š

```sh
# PC2
./phxcomo_test 192.168.0.22:1111 192.168.0.22:1111,192.168.0.10:1111,192.168.0.12:1111 n
# PC3
./phxcomo_test 192.168.0.10:1111 192.168.0.10:1111,192.168.0.12:1111,192.168.0.22:1111 n
# PC1
./phxcomo_test 192.168.0.12:1111 192.168.0.12:1111,192.168.0.10:1111,192.168.0.22:1111 y
```

### 3.2 ç»“æœ

å‘é€èŠ‚ç‚¹å°†å‘é€è®¸å¤šæ¡PhxProposeï¼Œå¹¶ç»™å‡ºå¯¹åº”çš„çŠ¶æ€åŒæ­¥æ‰€éœ€æ—¶é—´`use_time1`ï¼Œä»¥åŠä»å‘èµ·åŒæ­¥è¯·æ±‚åˆ°ä¿¡å·é‡è¢«è®¾ç½®çš„æ—¶é—´`use_time2`ã€‚
